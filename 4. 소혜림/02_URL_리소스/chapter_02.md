# URL과 리소스

- 인터넷 = 거대한 도시
- 도시의 주소・전화번호처럼 인터넷도 자원을 찾는 표준 이름 필요
- 그 역할을 하는 게 **URL** (리소스의 위치 + 접근 방법 알려줌)

## 인터넷의 리소스 탐색하기

- URI: 더 큰 개념, URL + URN 포함
  - URL → 위치 기반 식별
  - URN → 이름 기반 식별
- URL: 브라우저가 리소스 위치를 찾는 주소 (HTTP 등 프로토콜로 접근)
- HTTP 명세: URI 사용하지만, 실제로는 대부분 URL을 의미

### URL 구조와 의미

- URL은 크게 스킴(Scheme) / 서버 위치 / 경로 3부분으로 구성됨.
  - http:// → 스킴: 어떤 프로토콜로 접근할지
  - www.joes-hardware.com → 서버 위치: 리소스가 있는 서버
  - /seasonal/index-fall.html → 경로: 서버 안에서 구체적인 리소스 위치
- HTTP 말고도 다양한 프로토콜 사용 가능:
  - mailto: (이메일)
  - ftp:// (파일 전송)
  - rtsp:// (스트리밍)
- URL의 장점: 인터넷 리소스를 일관된 방식으로 지칭하고 찾을 수 있음.

### URL 이전의 암흑기 vs 이후

- 이전: 애플리케이션마다 다른 방식 → 복잡하고 불편
  - 예: FTP 서버 접속 → 로그인 → 디렉토리 이동 → 전송 모드 전환 → 다운로드
- 이후: URL 한 줄로 접근 가능
  - 예: ftp://ftp.lots-o-books.com/pub/complete-catalog.xls
- 브라우저: 다양한 프로토콜을 하나의 인터페이스로 통합
- 효과: 리소스 접근 단순화, 사용자 편리성 ↑

## URL 문법

일반 구조:
<스킴>://<사용자이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>

- 스킴: 어떤 프로토콜로 접근할지 (예: http, ftp), ':'로 URL의 나머지 부분과 구분
- 사용자이름/비밀번호: 인증 필요한 경우 사용 (기본값: anonymous / 이메일), 사용자 이름과 비밀번호를 요구하는 대표적 스킴은 FTP
- 호스트: 서버 주소 (도메인명 or IP), 접근하려고 하는 리소스를 가지고 있는 인터넷상의 호스트 장비
- 포트: 서버가 열어둔 네트워크 포트 번호 (HTTP 기본값 80 - TCP 프로토콜 사용)
- 경로: 서버 안에서 리소스 위치, 계층적 파일 시스템 경로와 유사한 구조, 경로조각은 자체만의 파라미터 컴포넌트를 가질 수 있음.
- 파라미터: 특정 리소스에 전달할 부가 정보 (세미콜론 구분), 정확한 요청을 위해 사용
- 질의(Query): ? 뒤에 오는 값, 보통 검색/데이터 전달용, 요청받을 리소스 형식의 범위를 좁히기 위해 사용, 컴포넌트 포맷에 제약 없음.
- 프래그먼트(Fragment): 리소스 내부 특정 위치를 가리킴 (#), 서버에는 전달되지 않고 클라이언트에서만 사용됨 (서버는 전체 리소스 전달, 브라우저가 프래그먼트를 사용하여 리소스 일부를 보여줌.)

## 단축 URL

- 브라우저는 일부만 입력해도 자동으로 완성해줌 (URL 자동 확장)
  - 예: `naver` 입력 → `http://www.naver.com/`으로 확장

### 절대 URL

- 리소스 전체 정보를 모두 포함
- 예: `http//example.com/images/pics.png`

### 상대 URL

- base URL을 기준으로 해석되는 짧은 URL
- 예:

  - base: `http://example.com/docs`
  - 상대 URL: `guide.html`

- 장점:

  - HTML 작성 단순화 (스킴, 호스트 반복 입력 불필요)
  - 문서 집합을 다른 위치로 옮겨도 base만 바꾸면 정상 작동
  - 사이트 구조 변경에 유리

- 기저 URL: 상대 URL 해석 시 기준이 되는 주소
  - 기저 URL을 정하는 방법
    1. HTML 문서 내 `<base>` 태그로 명시
    2. 문서 자체의 URL 사용 (기저 URL 미명시 시)
    3. 기저 URL이 업스면 → 절대 URL만 가능 (불완전 URL 가능성 있음)

## 상대 URL → 절대 URL 변환

- 기저 URL + 상대 URL → 절대 URL로 변환
- 컴포넌트 단위로 분리해 처리 (스킴, 호스트, 포트, 경로 등)
- RFC 1808, RFC 2396에 정의된 알고리즘 사용

### 변환 규칙

1. 경로 비어 있음 → 기저 URL 경로 사용
2. 스킴 있음 → 그대로 절대 URL로
3. 경로만 있음
   - . → 현재 디렉터리
   - .. → 상위 디렉터리
   - 파일명 → 기저 URL 경로에 이어 붙임
4. 사용자/비밀번호, 호스트, 포트 → 기저 URL 기준으로 상속 또는 대체

## URL 확장

- 호스트명(서버를 가리키는 이름) 확장:

  - 호스트명을 실제 IP 주소로 변환
  - DNS를 통해 변환 수행
  - 예: www.yahoo.com → IP 주소

- 히스토리 확장:
  - 사용자가 입력한 짧은 문자열을 브라우저가 과거 기록 기반으로 전체 URL로 확장
  - 예: "yahoo" → "http://www.yahoo.com"

## 안전하지 않은 문자

- URL은 모든 프로토콜에서 안전하게 전달되도록 설계됨
- SMTP 같은 프로토콜은 특정 문자를 제거할 수 있음 → 손실 위험
- 따라서 URL은 일반적으로 안전한 알파벳 문자만 허용
- 출력되지 않거나 변환될 수 있는 문자는 사용 금지
- 하지만 알파벳 외 문자가 필요할 때가 있어 → 이스케이프 기능 도입
  - 안전하지 않은 문자를 안전한 문자(코드)로 인코딩 가능

### URL 문자 집합

- URL 기본 문자 집합 → US-ASCII (7비트, 영문 중심)
- 한계: 영어 외 여러 언어(특히 비라틴계 문자) 미지원
- 필요: URL에 이진 데이터나 다양한 문자 포함해야 할 때 있음
- 해결: 이스케이프 문자열 도입
  - US-ASCII에서 금지된 문자나 데이터를 안전하게 인코딩
  - URL의 이동성과 완성도를 높임

### 인코딩 체계(URL 인코딩/이스케이프)

- 안전한 문자 집합만으로 표현의 한계가 있어, URL에 있는 안전하지 않은 문자들을 표현할 수 있는 인코딩 방식이 고안됨.
- 안전하지 않은 문자 % + ASCII 16진수 코드로 표현
- 이를 통해 원래 허용되지 않는 문자도 안전하게 포함 가능
  - 예시:
    - 공백 → %20 / http://www.joes-hardware.com/more%20tools.html
    - % → %25 / http://www.joes-hardware.com/100%25satisfaction.html

## 문자 제한

- 몇몇 문자는 URL 내에서 특별한 의미로 예약되어 있고, 어떤 문자는 US-ASCII의 출력 가능한 문자 집합에 포함되어 있지 않다.
- URL에서 예약된 문자들을 본래의 목적이 아닌 다른 용도로 사용하려면, 반드시 인코딩해야 한다.
  - 예:
    - / - 경로 컴포넌트에 있는 경로 세그먼트를 나누는 용도로 선점됨.

### 좀 더 알아보기

- 과거엔 안전하지 않은 문자도 URL에 쓰였으나, 지금은 인코딩 필수
- 애플리케이션은 URL 입력 시 안전하지 않은 문자 반드시 인코딩해야 함
- 어떤 문자를 인코딩해야 하는지 애매하면 입력 단계에서 처리하는 게 안전
- 모든 문자를 무조건 인코딩하는 방식은 비효율적
- 실제로 안전하지 않은 문자를 인코딩하지 않는 애플리케이션도 존재 → 문제 발생
- 보안 위협: 악의적 사용자가 URL 패턴 매칭을 회피하여 필터링 무력화 가능 → URL 디코드 필요

## 대표적 스킴 요약

- http : 사용자 이름이나 비밀번호가 없다는 것을 제외하고는, 일반 URL 포맷을 지키는 **하이퍼텍스트 전송 프로토콜** 스킴. 포트값이 생략되어 있으면 기본값은 80.

  - 기본형식 : `http://(호스트):(포트)/(경로)?(질의)#(프래그먼트)`

- https : http 스킴과 거의 같지만, 넷스케이프에서 개발한 보안 소켓 계층을 사용함. 기본 포트값은 443.

  - 기본형식 : `https://(호스트):(포트)/(경로)?(질의)#(프래그먼트)`

- 이외에 mailto, ftp, rtsp, rtspu, file, news, telnet 등이 있음.

## URL의 한계 그리고 대안

- URL: 강력한 작명 규칙, 그러나 “주소”라서 위치가 바뀌면 무효화됨
- 해결책: 위치와 무관하게 객체를 식별하는 이름 사용

### 대안

- URN: 객체가 이동해도 항상 같은 객체를 가리키는 이름 (IETF 제안)
- PURL: 영구적인 URL, 실제 URL 위치는 중개 서버가 관리 → 항상 최신 위치로 연결
